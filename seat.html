<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Planner</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:#fff;flex-direction:column;}
#splash{position:fixed;inset:0;z-index:9;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff}
#splash b{font-size:36px;color:#4CAF50;margin-bottom:10px}
#splash i{width:120px;height:2px;background:#e0e0e0;overflow:hidden}
#splash i:after{content:"";display:block;width:40px;height:100%;background:#4CAF50;animation:l .9s infinite}
@keyframes l{from{transform:translateX(-40px)}to{transform:translateX(120px)}}
.app{width:90%;max-width:300px;visibility:hidden}
label{font-size:16px;color:#333;margin:0 0 6px 2px}
.row{display:flex;align-items:center;gap:8px;border-bottom:1px solid #ccc}
.row:focus-within{border-color:#ccc}
.row.err{border-color:#e53935}
.row.ok{border-color:#4CAF50}
input{flex:1 1 auto;min-width:0;border:0;padding:10px 2px;font-size:18px;background:0;outline:0}
input::placeholder{font-size:16px;color:#999}
button{flex:0 0 auto;max-width:35%;padding:6px 12px;border:1px solid #aaa;border-radius:20px;background:0;color:#aaa;font-size:14px;font-weight:bold;white-space:nowrap}
button.ready{background:#4CAF50;color:#fff;border-color:#4CAF50;cursor:pointer}
button.ready:active{background:#43a047;transform:scale(.97)}
.errmsg{font-size:13px;color:#e53935;margin:14px 0 0 2px;display:none}

/* Layout de poltronas */
#bus-wrapper{transform:scale(.8);transform-origin:top center;display:none;width:100%;flex-direction:column;align-items:center;margin-top:20px}
.bus-container{padding:20px;border:3px solid #b0b0b0;border-radius:16px;display:flex;flex-direction:column;align-items:center}
#cursoBox{position:relative;width:40px;height:122px;background:#4CAF50;color:#fff;font-weight:bold;display:flex;align-items:center;justify-content:center;margin-bottom:10px;overflow:hidden}
#cursoText{transform:rotate(-90deg);font-size:18px;white-space:nowrap}
.grid{display:grid;gap:14px 10px;justify-items:center}
.seat,.empty{width:54px;height:54px;display:flex;align-items:center;justify-content:center;border-radius:12px;position:relative}
.seat{background:#4CAF50;border:3px solid #4CAF50;color:#fff;font-weight:bold;cursor:pointer}
.seat::after{content:"";position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:32px;height:14px;border-radius:8px;background:#fff;border:3px solid #8c96b2}
.seat.white{background:#fff!important;border:3px solid #8c96b2!important;color:transparent!important;cursor:default!important;pointer-events:none!important}
.seat.white::after{border-color:#8c96b2!important}
.seat.selected{background:#e74c3c;border-color:#e74c3c}
.empty{background:0 0}
</style>
</head>
<body>
<div id="splash"><b>Planner</b><i></i></div>

<div class="app">
  <label>CPF</label>
  <div class="row">
    <input id="cpf" placeholder="CPF (somente números)" inputmode="numeric" pattern="[0-9]*" autocomplete="off">
    <button id="btn" disabled>ENTRAR</button>
  </div>
  <div class="errmsg" id="err"></div>
</div>

<div id="bus-wrapper">
  <div id="cursoBox"><div id="cursoText">AAL</div></div>
  <div class="bus-container">
    <div id="seats-grid" class="grid"></div>
  </div>
</div>

<script>
setTimeout(()=>{splash.remove();document.querySelector(".app").style.visibility="visible"},1600);

const $=s=>document.querySelector(s);
const cpf=$("#cpf"),btn=$("#btn"),err=$("#err");
const valido="35128248895";

cpf.oninput=()=>{
  const val=cpf.value.replace(/\D/g,"");
  cpf.value=val;
  btn.disabled = val!==valido;
  if(btn.disabled) { err.style.display="block"; err.textContent="CPF não autorizado"; } 
  else { err.style.display="none"; }
};

btn.onclick=()=>{
  sessionStorage.setItem("cpf",cpf.value);
  document.querySelector(".app").style.display="none";
  busWrapper=document.getElementById("bus-wrapper");
  busWrapper.style.display="flex";
  document.documentElement.requestFullscreen().catch(()=>{});
  loadSeats();
};

// Função para carregar layout de assentos do JSON
async function loadSeats(){
  const grid=$("#seats-grid");
  try {
    const res = await fetch("configs/0046.json");
    const data = await res.json();
    const layout = data.layout; // array de arrays
    grid.style.gridTemplateColumns = `repeat(${layout[0].length}, 54px)`;
    grid.innerHTML = "";
    layout.forEach(row=>{
      row.forEach(cell=>{
        const div = document.createElement("div");
        if(cell===null) div.className="empty";
        else if(cell==="white") div.className="seat white";
        else{
          div.className="seat";
          div.textContent = cell.toString().padStart(2,"0");
          div.onclick = ()=>selectSeat(div);
        }
        grid.appendChild(div);
      });
    });
  } catch(e){ alert("Erro ao carregar layout de assentos."); }
}

// Seleção única de poltrona
let selected=null;
function selectSeat(el){
  if(el.classList.contains("white")) return;
  if(selected) selected.classList.remove("selected");
  if(selected===el){ selected=null; el.classList.remove("selected"); return; }
  el.classList.add("selected");
  selected=el;
}
</script>
</body>
</html>
