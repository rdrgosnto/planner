<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pina | Ingresso</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: #fff;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    font-family: Arial, sans-serif;
    color: #000;
  }

  #containerIngresso {
    width: 90%;
    max-width: 400px;
    margin-top: 60px; /* imagem mais para cima */
    position: relative; 
    display: flex;
    justify-content: center;
    align-items: center;
    height: auto;
  }

  #containerIngresso img {
    width: 100%;
    height: auto;
    display: block;
    position: absolute; /* todas as imagens sobrepostas */
    top: 0;
    left: 0;
    transition: opacity 1s ease-in-out;
  }

  #btnCPF, #btnDownload {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 400px;
    background: #000;
    color: #fff;
    font-size: 16px;   /* texto maior */
    font-weight: bold;
    padding: 14px;     /* caixa maior */
    line-height: 1.2;  /* centraliza verticalmente */
    border: none;
    cursor: pointer;
    text-align: center;
  }

  #btnCPF input {
    width: 100%;
    background: #000;
    color: #fff;
    border: none;
    outline: none;
    font-size: 16px;
    font-weight: bold;
    padding: 14px 0; /* altura do input */
    text-align: center;
    line-height: 1.2;
  }

  #btnDownload {
    display: none;
  }

  .cursor::after {
    content: '|';
    font-weight: bold;
    animation: blink 1s step-start infinite;
  }

  @keyframes blink {
    0%,50% { opacity: 1; }
    50.01%,100% { opacity: 0; }
  }
</style>
</head>
<body>

<div id="containerIngresso">
  <img id="imgIngresso" src="https://drive.google.com/thumbnail?id=1-KRVOHrwUy83uttLnP8JVvJmnbmROnVe&sz=w1200" alt="Ingresso Digital" style="opacity:1; z-index:1;">
</div>

<button id="btnCPF">CPF (somente números)</button>
<button id="btnDownload">Baixar ingresso</button>

<script>
const btnCPF = document.getElementById('btnCPF');
const btnDownload = document.getElementById('btnDownload');
const imgIngresso = document.getElementById('imgIngresso');
const container = document.getElementById('containerIngresso');
const testCPF = '35128248895';
const downloadUrl = 'https://drive.google.com/uc?export=download&id=1-KRVOHrwUy83uttLnP8JVvJmnbmROnVe';

let estado = 'inicial';
let debounceTimer;

btnCPF.addEventListener('click', () => {
  if (estado === 'inicial' || estado === 'invalido') {
    btnCPF.innerHTML = '<input type="text" id="cpfInput" class="cursor" placeholder="CPF (somente números)">';
    const input = document.getElementById('cpfInput');
    input.focus();
    estado = 'digitando';

    input.addEventListener('input', () => {
      input.value = input.value.replace(/\D/g,''); // apenas números
      if (input.value.length === 11) {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => validarCPF(input.value), 400);
      }
    });
  }
});

function validarCPF(cpf) {
  if (!isValidCPF(cpf)) {
    btnCPF.innerText = 'CPF inválido';
    estado = 'invalido';
    return;
  }

  btnCPF.innerText = 'carregando...';
  let dots = 0;
  estado = 'carregando';
  const interval = setInterval(() => {
    if (estado !== 'carregando') { clearInterval(interval); return; }
    dots = (dots + 1) % 4;
    btnCPF.innerText = 'carregando' + '.'.repeat(dots);
  }, 500);

  setTimeout(() => {
    clearInterval(interval);
    if (cpf === testCPF) {
      estado = 'valido';

      // Crossfade absoluto
      const tempImg = new Image();
      tempImg.src = imgIngresso.src; // mesma imagem agora
      tempImg.style.opacity = 0;
      tempImg.style.width = '100%';
      tempImg.style.height = 'auto';
      tempImg.style.position = 'absolute';
      tempImg.style.top = '0';
      tempImg.style.left = '0';
      tempImg.style.transition = 'opacity 1s ease-in-out';
      tempImg.style.zIndex = 2;
      container.appendChild(tempImg);

      setTimeout(() => { tempImg.style.opacity = 1; }, 50);
      setTimeout(() => {
        imgIngresso.style.opacity = 0;
        setTimeout(() => {
          imgIngresso.src = tempImg.src;
          imgIngresso.style.opacity = 1;
          tempImg.remove();

          btnCPF.style.display = 'none';
          btnDownload.style.display = 'block';
        }, 1000);
      }, 1050);

    } else {
      btnCPF.innerText = 'CPF não autorizado';
      estado = 'invalido';
    }
  }, 1500);
}

function isValidCPF(cpf) {
  if(cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
  let sum = 0;
  for(let i=0;i<9;i++) sum += parseInt(cpf.charAt(i)) * (10-i);
  let rev = 11 - (sum % 11);
  if(rev===10||rev===11) rev = 0;
  if(rev!==parseInt(cpf.charAt(9))) return false;
  sum=0;
  for(let i=0;i<10;i++) sum += parseInt(cpf.charAt(i)) * (11-i);
  rev = 11 - (sum % 11);
  if(rev===10||rev===11) rev = 0;
  return rev === parseInt(cpf.charAt(10));
}

btnDownload.addEventListener('click', () => {
  const a = document.createElement('a');
  a.href = downloadUrl;
  a.download = 'ingresso.png';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
});
</script>

</body>
</html>
