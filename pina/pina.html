<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Planner | Pina</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}html,body{min-height:100%;background:#121212;color:#fff;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}body{display:flex;justify-content:center;padding:0}.app{width:100%;max-width:420px;min-height:100vh;display:flex;flex-direction:column;justify-content:flex-start}.card{background:#1c1c1c;border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,.06);box-shadow:0 8px 24px rgba(0,0,0,.4);display:flex;flex-direction:column;min-height:100vh;position:relative}.logo{position:absolute;top:24px;left:50%;transform:translateX(-50%);z-index:2}.logo img{height:44px;display:block;filter:invert(1) brightness(1.1)}.ingresso{position:relative;margin:80px 0 16px}.ingresso img{width:100%;display:block;border-radius:10px}.loading-img{position:absolute;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;border-radius:10px;font-size:14px;color:#cfcfcf;opacity:0;pointer-events:none;transition:opacity .2s ease}.loading-img.ativo{opacity:1}.texto{font-size:14px;color:#fff;margin-bottom:10px;padding-left:3px}.cpf-field{position:relative;height:42px;width:100%;border-radius:8px;border:1px solid rgba(255,255,255,.15);background:#151515;display:flex;align-items:center;padding:0 12px}.cpf-field:focus-within{border-color:#fff}#cpfInput{width:100%;height:100%;border:none;outline:none;background:transparent;color:#fff;font-size:14px;padding-left:2px;caret-color:#fff}#cpfInput::placeholder{font-size:12px}.status{margin-top:8px;font-size:14px;min-height:18px;display:flex;align-items:center;padding-left:3px}.btn-primary{margin-top:12px;width:100%;height:42px;border:none;border-radius:8px;background:#fff;color:#000;font-size:15px;font-weight:500;cursor:pointer;display:none}.btn-primary:hover{background:#eaeaea}
</style>
</head>
<body>
<main class="app">
<section class="card">
<div class="logo"><img src="pina_.png" alt="Pina"></div>
<div class="ingresso">
<img id="imgIngresso" src="https://drive.google.com/thumbnail?id=1-KRVOHrwUy83uttLnP8JVvJmnbmROnVe&sz=w1200">
<div class="loading-img" id="loadingImg">carregando…</div>
</div>
<div class="texto">CPF (somente números)</div>
<div class="cpf-field"><input id="cpfInput" inputmode="numeric" enterkeyhint="done" placeholder="CPF (somente números)" autocomplete="off"></div>
<div class="status" id="statusMsg"></div>
<button class="btn-primary" id="btnDownload">Baixar ingresso</button>
</section>
</main>
<script>
const cpf=document.getElementById("cpfInput"),btn=document.getElementById("btnDownload"),img=document.getElementById("imgIngresso"),status=document.getElementById("statusMsg"),load=document.getElementById("loadingImg");let debounce;
const vibrar=()=>navigator.vibrate&&navigator.vibrate(30),norm=v=>v.replace(/\D/g,"").padStart(11,"0"),valido=c=>{if(/^(\d)\1+$/.test(c))return!1;for(let t=9;t<11;t++){let s=0;for(let i=0;i<t;i++)s+=c[i]*(t+1-i);if(((s*10)%11)%10!=c[t])return!1}return!0};
async function buscar(c){const r=await fetch("https://default264c851fa4e743cf86bcd7b10dca85.78.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/8a482c5f6dd04dd3b167d97ea0a07307/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=kWvGjXp0sqrlB9TuVb02vSAeLqwEjTU0-dU9J0HqkFE",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cpf:c})});const d=await r.json();return(d.codigo||[]).find(x=>norm(x.CPF2||"")===c&&x.GOOGLE)}
cpf.oninput=()=>{cpf.value=cpf.value.replace(/\D/g,"");btn.style.display="none";vibrar();if(cpf.value.length<11){status.textContent="CPF inválido";return}cpf.blur();clearTimeout(debounce);debounce=setTimeout(()=>validar(norm(cpf.value)),400)}
async function validar(c){if(!valido(c)){vibrar();status.textContent="CPF inválido";return}status.textContent="";load.classList.add("ativo");try{const a=await buscar(c);if(!a)throw 0;btn.style.display="block";btn.textContent="carregando…";status.textContent="CPF localizado";const id=a.GOOGLE;img.onload=()=>load.classList.remove("ativo");img.src=`https://drive.google.com/thumbnail?id=${id}&sz=w1200`;setTimeout(()=>{load.classList.remove("ativo");btn.textContent="Baixar ingresso";btn.onclick=()=>{const l=document.createElement("a");l.href=`https://drive.google.com/uc?export=download&id=${id}`;l.download="ingresso.png";document.body.appendChild(l);l.click();document.body.removeChild(l)};btn.scrollIntoView({behavior:"smooth",block:"center"})},600)}catch{vibrar();load.classList.remove("ativo");btn.style.display="none";status.textContent="CPF não autorizado"}}
</script>
</body>
</html>
