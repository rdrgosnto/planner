<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pina | Ingresso</title>

<style>
* { box-sizing: border-box; margin:0; padding:0; }

html, body {
    width:100%;
    height:100%;
    background:#000;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    color:#fff;
    overflow:hidden;
}

/* ===== V√çDEO DE FUNDO ===== */
#videoFundo {
    position:absolute;
    top:50%;
    left:50%;
    width:100%;
    height:100%;
    transform:translate(-50%,-50%);
    object-fit:contain;
    background:#000;
    z-index:0;
}

/* Camada escura cinematogr√°fica */
.cinema-overlay {
    position:absolute;
    inset:0;
    background:linear-gradient(
        to bottom,
        rgba(0,0,0,.55),
        rgba(0,0,0,.25),
        rgba(0,0,0,.55)
    );
    z-index:1;
}

/* ===== CONTE√öDO ===== */
.overlay {
    position:absolute;
    inset:0;
    z-index:2;
}

/* Grupo CPF (controla espa√ßamento igual) */
.cpf-group {
    position:absolute;
    top:62vh; /* üîΩ MAIS PARA BAIXO */
    left:50%;
    transform:translateX(-50%);
    width:90%;
    max-width:400px;
    display:flex;
    flex-direction:column;
    gap:10px; /* üîÅ dist√¢ncia igual entre textos e caixa */
}

/* Texto acima */
.label-cpf {
    font-size:14px;
}

/* Caixa CPF */
.cpf-field {
    height:44px;
    border-radius:0; /* quadrada */
    border:1px solid rgba(255,255,255,.25);
    background:rgba(0,0,0,.45);
    display:flex;
    align-items:center;
    padding:0 12px;
    backdrop-filter: blur(4px);
}

.cpf-field input {
    width:100%;
    height:100%;
    border:none;
    outline:none;
    background:transparent;
    color:#fff;
    font-size:14px;
}

.cpf-field input::placeholder {
    font-size:12px;
    color:#cfcfcf;
}

/* Status */
.status {
    min-height:18px;
    font-size:14px;
}

/* Bot√£o */
.btn-primary {
    display:none;
    height:44px;
    border:none;
    border-radius:0;
    background:#fff;
    color:#000;
    font-size:15px;
    font-weight:500;
    cursor:pointer;
}

.btn-primary:hover {
    background:#eaeaea;
}
</style>
</head>
<body>

<!-- V√≠deo -->
<video id="videoFundo" autoplay muted playsinline loop>
    <source src="pina_.mp4" type="video/mp4">
</video>

<div class="cinema-overlay"></div>

<div class="overlay">

    <div class="cpf-group">
        <div class="label-cpf">CPF (somente n√∫meros)</div>

        <div class="cpf-field">
            <input id="cpfInput" inputmode="numeric" placeholder="CPF (somente n√∫meros)">
        </div>

        <div class="status" id="statusMsg"></div>

        <button class="btn-primary" id="btnDownload">Baixar ingresso</button>
    </div>

</div>

<script>
const cpfInput = document.getElementById("cpfInput");
const btnDownload = document.getElementById("btnDownload");
const statusMsg = document.getElementById("statusMsg");

let debounce;

/* ===== CPF ===== */
const norm = v => v.replace(/\D/g,"").padStart(11,"0");
const valido = c => {
    if(/^(\d)\1+$/.test(c)) return false;
    for(let t=9;t<11;t++){
        let s=0;
        for(let i=0;i<t;i++) s+=c[i]*(t+1-i);
        if(((s*10)%11)%10!=c[t]) return false;
    }
    return true;
};

/* ===== POWER AUTOMATE ===== */
async function buscarIngresso(cpf){
    const r = await fetch(
        "https://default264c851fa4e743cf86bcd7b10dca85.78.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/8a482c5f6dd04dd3b167d97ea0a07307/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=kWvGjXp0sqrlB9TuVb02vSAeLqwEjTU0-dU9J0HqkFE",
        {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify({ cpf })
        }
    );
    const d = await r.json();
    return (d.codigo||[]).find(x => norm(x.CPF2||"") === cpf && x.GOOGLE);
}

/* ===== INPUT ===== */
cpfInput.oninput = () => {
    cpfInput.value = cpfInput.value.replace(/\D/g,"");
    btnDownload.style.display="none";
    statusMsg.textContent="";
    clearTimeout(debounce);

    if(cpfInput.value.length < 11){
        statusMsg.textContent="CPF inv√°lido";
        return;
    }

    debounce = setTimeout(() => validarCPF(norm(cpfInput.value)), 400);
};

async function validarCPF(cpf){
    if(!valido(cpf)){
        statusMsg.textContent="CPF inv√°lido";
        return;
    }

    statusMsg.textContent="Verificando CPF‚Ä¶";

    try{
        const autorizado = await buscarIngresso(cpf);
        if(!autorizado) throw 0;

        statusMsg.textContent="CPF localizado";
        btnDownload.style.display="block";

        const id = autorizado.GOOGLE;
        btnDownload.onclick = () => {
            const a = document.createElement("a");
            a.href = `https://drive.google.com/uc?export=download&id=${id}`;
            a.download = "ingresso.png";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };

    } catch {
        statusMsg.textContent="CPF n√£o autorizado";
        btnDownload.style.display="none";
    }
}
</script>

</body>
</html>
