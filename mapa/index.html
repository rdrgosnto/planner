<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Planner | Mapa</title>
<style>
body{font-family:Arial;margin:0;padding:0;display:flex;flex-direction:column;min-height:100vh;justify-content:center;background:#fff}
.bus-container{padding:20px;border:3px solid #b0b0b0;border-radius:16px;width:fit-content;margin:20px auto;position:relative;display:flex;justify-content:center;flex-direction:column;align-items:center}
.grid{display:grid;grid-template-columns:repeat(5,60px);gap:14px 10px;justify-content:center;justify-items:center}
.seat,.empty{width:60px;height:60px;display:flex;align-items:center;justify-content:center;border-radius:12px;position:relative;color:#fff;font-weight:bold;cursor:pointer;user-select:none}
.seat.green{background:#4CAF50}
.seat.selected{background:#e74c3c}
.seat.mine{background:#555;cursor:default;pointer-events:none}
.seat.white{background:#ccc;cursor:default;pointer-events:none}
.seat.lost-temp{background:#aaa}
#confirmarBtn{width:120px;height:50px;background:#4CAF50;color:#fff;border:none;font-size:16px;font-weight:bold;border-radius:12px;cursor:pointer;margin-top:20px}
</style>
</head>
<body>

<div class="bus-container">
  <div class="grid" id="busGrid"></div>
  <button id="confirmarBtn">CONFIRMAR</button>
</div>

<script>
const grid = document.getElementById("busGrid");
const btn = document.getElementById("confirmarBtn");
let sel = null;

// Simulação de dados do usuário e ocupadas
let userSeats = ["03"];             // Poltrona do usuário
let occupiedSeats = ["05","08"];    // Poltronas ocupadas
let conflictSeats = ["10"];         // Poltronas que “pegaram” outro usuário

// Criar poltronas 01 a 15
for(let i=1;i<=15;i++){
  const seat = document.createElement("div");
  seat.className = "seat green";
  seat.textContent = i.toString().padStart(2,"0");
  seat.dataset.id = i.toString().padStart(2,"0");

  if(userSeats.includes(seat.dataset.id)){
    seat.classList.remove("green");
    seat.classList.add("mine");
  } else if(occupiedSeats.includes(seat.dataset.id)){
    seat.classList.remove("green");
    seat.classList.add("white");
  } else if(conflictSeats.includes(seat.dataset.id)){
    seat.classList.remove("green");
    seat.classList.add("lost-temp");
    setTimeout(()=>{ 
      seat.classList.remove("lost-temp");
      seat.classList.add("white");
      seat.onclick = null;
    }, 5000);
  } else {
    seat.onclick = () => {
      if(sel) sel.classList.remove("selected");
      sel = sel === seat ? null : seat;
      if(sel) sel.classList.add("selected");
    };
  }

  grid.appendChild(seat);
}

// Botão CONFIRMAR
btn.onclick = () => {
  if(!sel){
    alert("Selecione uma poltrona.");
    return;
  }

  const ok = confirm("Confirma a poltrona selecionada?");
  if(!ok){
    // Cancelar → poltrona verde e clicável
    sel.classList.remove("selected");
    sel.style.pointerEvents = "auto";
    sel = null;
    return;
  }

  // Conflito simulado
  if(sel.classList.contains("lost-temp")){
    alert("Poltrona selecionada por outro usuário.");
    sel.classList.remove("selected");
    sel.classList.add("white");
    sel.onclick = null;
    sel = null;
    return;
  }

  // Troca: liberar poltrona antiga do usuário
  if(userSeats.length > 0){
    const antigaId = userSeats[0];
    const antigaSeat = document.querySelector(`.seat[data-id="${antigaId}"]`);
    antigaSeat.classList.remove("mine");
    antigaSeat.classList.add("green");
    antigaSeat.onclick = () => {
      if(sel) sel.classList.remove("selected");
      sel = sel === antigaSeat ? null : antigaSeat;
      if(sel) sel.classList.add("selected");
    };
  }

  // Nova poltrona do usuário
  sel.classList.add("mine");
  sel.classList.remove("selected","green");
  sel.onclick = null;
  userSeats = [sel.dataset.id];
  sel = null;
  alert("Poltrona confirmada!");
};
</script>

</body>
</html>
